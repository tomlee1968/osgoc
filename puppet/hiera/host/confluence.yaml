---
hiera::certificate:
  confluence.grid.iu.edu:
    cert:
      path: /etc/grid-security/host/cert.pem
      source: puppet:///modules/hiera/certificates/confluence.grid.iu.edu_cert.pem
      owner: root
      group: root
      mode: 0644
      replace: true
    key:
      path: /etc/grid-security/host/key.pem
      content: |
        ENC[PKCS7,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]
      owner: root
      group: root
      mode: 0600
      replace: true
    notify:
      - Exec[rebuild_certkey_p12]

hiera::exec:
  rebuild_certkey_p12:
    command: /usr/bin/openssl pkcs12 -export -out /etc/grid-security/host/certkey.p12 -in /etc/grid-security/host/cert.pem -CApath /etc/grid-security/certificates -inkey /etc/grid-security/host/key.pem -password pass:3c894242
    refreshonly: true
    notify:
      - Service[confluence]

hiera::service:
  confluence:
    ensure: running
    enable: true
    hasrestart: true
    hasstatus: true
