###############################################################################
## Unified GOC Kickstart Template
###############################################################################

## By Tom Lee <thomlee@iu.edu>
## Last modified 2016/02/04

## This relies on variables set in the 'ksmeta' parameter of the
## distro, profile or system record in Cobbler.  These are the
## variables we check:

## kvmhost: If set, this is a physical KVM host.  The values of
## "virtual" and "stemcell" will be ignored.  If unset, this may be
## either a vanilla physical host or a VM (stemcell or not).  The
## values of "virtual" and "stemcell" will determine which.

## vmwhost: Same as "kvmhost", for VMware hosts.  If both "kvmhost"
## and "vmwhost" are set for some reason, the results will be
## unpredictable.  Don't do that.

## stemcell: If set, we are rebuilding the stemcell base VM image that
## the "mkvm" command uses to build new VMs.  Assumes that "virtual"
## is true.  This variable's value is ignored if the value of either
## "kvmhost" or "vmwhost" is set to any true value.  If unset, this
## may be a physical host (KVM or not) or a vanilla VM installation.

## virtual: If set, this is a virtual machine, not a physical host.
## The value of "stemcell" determines whether this is a stemcell
## rebuild or just a vanilla VM install.  This variable's value is
## ignored if the value of either "kvmhost" or "vmwhost" is set to any
## true value.  If "stemcell" is true, then "virtual" is also assumed
## true.

## vmtype: Ignored if "kvmhost" or "vmhost" is true, but if "stemcell"
## is true, this means we're installing on the given type of VM host:
## "vmw" for VMware or "kvm" for KVM.

## distro: The code for the distro to install.  Currently this is one
## of:
## 5 (for RHEL 5)
## 6 (for RHEL 6)
## c6 (for CentOS 6)
## c7 (for CentOS 7)
## There could potentially be other codes for other distros, depending
## on whether Cobbler/Anaconda can install them or not.

## cndn: Whether the hardware and distro in question uses Consistent
## Network Device Naming -- they must both (hardware and distro)
## support it, but if they do, the onboard network devices will be
## named em1, em2, etc.  If the hardware doesn't support it, or if the
## distro doesn't, the old eth0/eth1/etc. name scheme will still be
## used.

#if $getVar('kvmhost', '') or $getVar('vmwhost', '')
  #set global stemcell=''
  #set global virtual=''
#else if $getVar('stemcell', '')
  #set global virtual=1
#end if

## Using virtio changes the drive devices to /dev/vd*.  This is even
## true on RHEL 5 guests.  It is still true that non-virtio IDE virtual
## disks are called /dev/hd* on RHEL 5 and /dev/sd* on newer RHELs,
## however.  Non-virtio SCSI disks are called /dev/sd* everywhere, I
## believe.

#if $getVar('virtual', '') and $getVar('vmtype', '') == 'kvm'
  #set global hdpre='vd'
#else
  #if $getVar('distro', '') == '5'
    #if $getVar('system_name', '') == 'goc-rhel5-32-generic-bundy'

## because bundy.uits.indiana.edu is an odd duck and has SCSI drives

      #set global hdpre='sd'
    #else
      #set global hdpre='hd'
    #end if
  #else
    #set global hdpre='sd'
  #end if
#end if

## Set this to 1 for console output, or to '' for normal operation
#set global console_log=1

## Set this to 1 for pauses during the postinstall script, or to ''
##for normal operation.
#set global install_pause=1

## Config parameter 'cndn' governs whether the hardware and OS support
## Consistent Network Device Naming -- if present, use em1/em2;
## otherwise eth0/eth1
#if $getVar('cndn', '')
  #set global if01='em1'
  #set global if02='em2'

  ## Special cases

  #if $getVar('system_name', '') == 'goc-centos6-generic-vanheusen'

    ## vanheusen (osg-xd) has four Ethernet adapters; the first two (em1, em2)
    ## are 10Gb and connected to the public VLAN.  The third is 1Gb and
    ## connected to the private VLAN, so if02 should be set to em3.

    #set global if02='em3'
  #end if
#else

  ## The usual non-CNDN scenario

  #set global if01='eth0'
  #set global if02='eth1'

  ## Special non-CNDN cases

  #if $getVar('system_name', '') == 'goc-centos6-generic-riley'

    ## riley (sib-itb) has 6 Ethernet adapters, and for some reason eth4 and
    ## eth5 are used.

    #set global if01='eth4'
    #set global if02='eth5'
  #end if
#end if

#if $getVar('distro', '') == '5'
  #set global distroname='RHEL 5'
#else if $getVar('distro', '') == '6'
  #set global distroname='RHEL 6'
#else if $getVar('distro', '') == 'c6'
  #set global distroname='CentOS 6'
#else if $getVar('distro', '') == 'c7'
  #set global distroname='CentOS 7'
#else
  #set global distroname='Something Else'
#end if

# Anaconda kickstart file for installing $getVar('distroname', '(This Should Never Happen)')
# This file was generated by Cobbler

# Some variables:
# distro_name: $getVar('distro_name', '(undefined)')
# profile_name: $getVar('profile_name', '(undefined)')
# system_name: $getVar('system_name', '(undefined)')
# distro: $getVar('distro', '(undefined)')
# kvmhost: $getVar('kvmhost', '(undefined)')
# vmwhost: $getVar('vmwhost', '(undefined)')
# virtual: $getVar('virtual', '(undefined)')
# stemcell: $getVar('stemcell', '(undefined)')
# vmtype: $getVar('vmtype', '(undefined)')
# cndn: $getVar('cndn', '(undefined)')
# if01: $getVar('if01', '(undefined)')
# if02: $getVar('if02', '(undefined)')
# console_log: $getVar('console_log', '(undefined)')
# install_pause: $getVar('install_pause', '(undefined)')
